doctype html
html(lang="en")
  head
    meta("keywords", "WebRTC, HTML5, JavaScript")
    meta("name", "description" content="WebRTC Reference App")
    meta("viewport", "width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1")

    title Web RTC Test video chat ( developement)

    script(src="socket.io/socket.io.js")
    script(src="javascripts/lib/jquery.min.js")
    script(src="javascripts/helpers/utils.js")
    script(src="javascripts/lib/adapter.js")
    script(src="javascripts/lib/underscore-min.js")
    script(src="javascripts/lib/backbone-min.js")
    link(rel='stylesheet', href='stylesheets/style.css')

  body
    div.page#container
      include  snippets/popUp.html
      div#local-video-container
        div#video
      include  snippets/menuBar.html
  script(type="text/template")#peer-template
        <div>
        <div class="remotePeerInfo"> </div>
        <div class="remotePeerMediaContainer"> </div>
        </div>

    script(type="text/template")#peer-template-info
          <p> Peer : <strong> <%=peerId %> </strong> </p>
          <p class="inline smallLeftMargin"> Status :
          <p class="inline smallLeftMargin iceConnection">IceConnectionState : <%= iceConnectionState %> </p>
          <p class="inline smallLeftMargin iceGathering">IceGatheringState  : <%= iceGatheringState %> </p>
          <p class="inline smallLeftMargin signalingState">SignalingState : <%= signalingState %> </p>
          </p>

    script(type="text/template")#peer-template-media
           <video class="smallLeftMargin" autoplay='autoplay'></video>

    script(type="text/template")#localPeer-template
          <div class="localPeer"><p> Session initialized. Local peer  has received the following id : <strong><%=peerId %></strong> <br>
          Connected  peers : <strong><%=connectedPeers %></strong><br>
          Local Streams : <%=streams %><br>
          </p> </div>

    script(src="javascripts/model/PeerConnection.js")
    script(src="javascripts/model/PeerSession.js")
    script(src="javascripts/view/PeerView.js")
    script(src="javascripts/view/AppView.js")
    script(src="javascripts/helpers/SignalingServiceFrontEnd.js")
    script(src="javascripts/helpers/log.js")
    script(src="events/events.js")

    script(type='text/javascript').
            $(document).ready( function () {
            var toggle = true;
            function toggleSizeVideo() {
            var $video = $( "#local-video-container" );
            if($video.data('small')) {
                $video.animate({ "width": "200px", "height": "200px" });
                $video.data('small', false);
            } else {
                $video.animate({ "width": "80px", "height": "80px" });
                $video.data('small', true);
            }
            };
                function showBar() {
                $('#menu-bar').slideDown();
                toggleLocalVideo();
            }
                function hideBar() {
                $('#menu-bar').slideUp();
                toggleLocalVideo();
            }
                function isHidden(element) {
                return $(element).css('display') === 'none' ? true : false;
            }
                function toggleLocalVideo() {
                var $video = $( "#local-video-container" );
                if($video.data('down')) {
                    $video.animate({ "bottom": "-=50px" });
                    $video.data('down', false);
                } else {
                    $video.animate({ "bottom": "+=50px" });
                    $video.data('down', true);
                }
            }
                showBar();
            $('#menu-bar').data('timeoutId', setTimeout(hideBar , 2000));
            $( "#local-video-container").click(toggleSizeVideo);
                $(document).mousemove(function(event){
                var docheight = $( document ).height() - 10;
                if( event.pageY > docheight && isHidden('#menu-bar')){
                    showBar();
                        /*toggleBar();*/
                }
            });
                $("#menu-bar").mouseleave(function(){
                toggle = true;
            var menuBar = $(this);
            menuBar.data('timeoutId') && clearTimeout($(this).data('timeoutId'));
            menuBar.data('timeoutId', setTimeout(hideBar , 2000));
            }).mouseenter(function() {
            var menuBar = $(this);
            toggle = false;
            menuBar.data('timeoutId') && clearTimeout($(this).data('timeoutId'));
            });
            $(".video-icon").click(function() {
            $("#popup").show();
            setTimeout(function() {$("#popup").fadeOut()},1000);
            });
            });
